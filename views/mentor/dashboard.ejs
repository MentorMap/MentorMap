<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('../partials/meta', {pageTitle: 'Dashboard'}); %>

    <!-- Bootstrap -->
    <link href="/vendor/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- iCheck -->
    <link href="/vendor/iCheck/skins/flat/green.css" rel="stylesheet">
    <!-- PNotify -->
    <link href="/vendor/pnotify/dist/pnotify.css" rel="stylesheet">
    <link href="/vendor/pnotify/dist/pnotify.buttons.css" rel="stylesheet">
    <link href="/vendor/pnotify/dist/pnotify.brighttheme.css" rel="stylesheet">
    <link href="/vendor/pnotify/dist/pnotify.nonblock.css" rel="stylesheet">
	<!-- FullCalendar -->
	<link href="/vendor/fullcalendar/dist/fullcalendar.min.css" rel="stylesheet">
	<link href="/vendor/fullcalendar/dist/fullcalendar.print.css" rel="stylesheet" media="print">
    <!-- Custom Theme Style -->
    <link href="/base/stylesheets/bundle.min.css" rel="stylesheet">

  </head>

  <body class="nav-md">
    <div class="container body">
      <div class="main_container">

        <!-- left navigation -->
        <%- include('../partials/left_nav', {user: user}); %>
        <!-- /left navigation -->

        <!-- top navigation -->
        <%- include('../partials/top_nav', {user: user}); %>
        <!-- /top navigation -->

		<!-- page content -->
		<div class="right_col" role="main">
		  <div class="">
			<div class="page-title">
			  <div class="title_left" style="width: 100%;">
				<h3>My Dashboard <small>You can update your availability by dragging a time range</small></h3>
			  </div>
			</div>

			<div class="clearfix"></div>

			<div class="row">
			  <div class="col-md-12">
				<div class="x_panel">
				  <div class="x_title">
					<h2>Schedule</h2>
					<ul class="nav navbar-right panel_toolbox">
					  <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
					  </li>
					  <li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
						<ul class="dropdown-menu" role="menu">
						  <li><a href="#">Settings 1</a>
						  </li>
						  <li><a href="#">Settings 2</a>
						  </li>
						</ul>
					  </li>
					  <li><a class="close-link"><i class="fa fa-close"></i></a>
					  </li>
					</ul>
					<div class="clearfix"></div>
				  </div>
				  <div class="x_content">

					<div id='calendar'></div>

				  </div>
				</div>
			  </div>
			</div>
		  </div>
		</div>
		<!-- /page content -->

        <!-- footer content -->
        <%- include('../partials/footer'); %>
        <!-- /footer content -->
      </div>
    </div>

	<!-- calendar modal -->
    <div id="CalenderModalNew" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
      <div class="modal-dialog">
        <div class="modal-content">

          <div class="modal-header">
            <button type="button" class="close close1" data-dismiss="modal" aria-hidden="true">×</button>
            <h4 class="modal-title" id="myModalLabel">New Calendar Entry</h4>
          </div>
          <!-- <div class="modal-body">
            <div id="testmodal" style="padding: 5px 20px;">
              <form id="antoform" class="form-horizontal calender" role="form">
				<div class="form-group">
				  <label class="col-sm-3 control-label">Date</label>
				  <div class="col-sm-9">
					<input type="text" class="form-control" id="date" onkeydown="return false;">
				  </div>
				</div>
				<div class="form-group">
				  <label class="col-sm-3 control-label">Start</label>
				  <div class="col-sm-9">
					<input type="text" class="form-control" id="start" onkeydown="return false;">
				  </div>
				</div>
				<div class="form-group">
				  <label class="col-sm-3 control-label">End</label>
				  <div class="col-sm-9">
					<input type="text" class="form-control" id="end" onkeydown="return false;">
				  </div>
				</div>
              </form>
            </div>
          </div> -->
          <div class="modal-footer">
            <button type="button" id='close1' class="btn btn-default close1" data-dismiss="modal" style='margin: 0;'>Close</button>
            <button type="button" id='add' class="btn btn-success antosubmit">Add Time Slot</button>
          </div>
        </div>
      </div>
    </div>
    <div id="CalenderModalEdit" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
      <div class="modal-dialog">
        <div class="modal-content">

          <div class="modal-header">
            <button type="button" class="close close2" data-dismiss="modal" aria-hidden="true">×</button>
            <h4 class="modal-title" id="myModalLabel2">Edit Calendar Entry</h4>
          </div>
          <!-- <div class="modal-body">

            <div id="testmodal2" style="padding: 5px 20px;">
              <form id="antoform2" class="form-horizontal calender" role="form">
				<div class="form-group">
  				  <label class="col-sm-3 control-label">Date</label>
  				  <div class="col-sm-9">
  					<input type="text" class="form-control" id="date2" name="title" onkeydown="return false;">
  				  </div>
  				</div>
  				<div class="form-group">
  				  <label class="col-sm-3 control-label">Start</label>
  				  <div class="col-sm-9">
  					<input type="text" class="form-control" id="start2" name="title" onkeydown="return false;">
  				  </div>
  				</div>
  				<div class="form-group">
  				  <label class="col-sm-3 control-label">End</label>
  				  <div class="col-sm-9">
  					<input type="text" class="form-control" id="end2" name="title" onkeydown="return false;">
  				  </div>
  				</div>

              </form>
            </div>
          </div> -->
          <div class="modal-footer">
            <button type="button" id='close2' class="btn btn-default close2" data-dismiss="modal" style="margin: 0;">Close</button>
			<button type="button" id='delete' class="btn btn-danger antoupdate" style="margin: 0;">Delete</button>
            <button type="button" id='update' class="btn btn-success">Update Time Slot</button>
          </div>
        </div>
      </div>
    </div>

    <div id="fc_create" data-toggle="modal" data-target="#CalenderModalNew"></div>
    <div id="fc_edit" data-toggle="modal" data-target="#CalenderModalEdit"></div>
    <!-- /calendar modal -->

    <!-- jQuery -->
    <script src="/vendor/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="/vendor/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- FastClick -->
    <script src="/vendor/fastclick/lib/fastclick.js"></script>
    <!-- iCheck -->
    <script src="/vendor/iCheck/icheck.min.js"></script>
    <!-- gauge.js
    <script src="/vendor/bernii/gauge.js/dist/gauge.min.js"></script>

    <script src="/vendor/Chart.js/dist/Chart.min.js"></script>
	-->
    <!-- jQuery Sparklines -->
    <script src="/vendor/jquery-sparkline/dist/jquery.sparkline.min.js"></script>
    <!-- PNotify -->
    <script src="/vendor/pnotify/dist/pnotify.js"></script>
    <script src="/vendor/pnotify/dist/pnotify.buttons.js"></script>
    <script src="/vendor/pnotify/dist/pnotify.nonblock.js"></script>
	<!-- FullCalendar -->
	<script src="/vendor/moment/min/moment.min.js"></script>
	<script src="/vendor/moment/moment-timezone.js"></script>
	<script src="/vendor/fullcalendar/dist/fullcalendar.min.js"></script>
    <!-- Custom Theme Scripts -->
    <script src="/vendor/gentelella/js/custom.min.js"></script>



	<!-- FullCalendar -->
    <script>
      $(window).load(function() {

		  var user = <%- JSON.stringify(user) %>;
		  var calEvents = user.upcomingSessions

        var calendar = $('#calendar').fullCalendar({
          header: {
            left: 'prev,next today',
            center: 'title',
            right: 'month,agendaWeek,agendaDay'
          },
		  defaultView: 'agendaWeek',
          selectable: true,
          selectHelper: true,
          select: function(start, end, allDay) {
			if (calendar.fullCalendar( 'getView' ).name === 'month')
				return false
            $('#fc_create').click();

            $("#add").off().on("click", function() {
				$.post('/mentor/availability', {
					title: 'available',
					start: start.valueOf(),
					end: end.valueOf()
				}).done(function (res) {
					calendar.fullCalendar('renderEvent', {
						title: 'available',
						start: start,
						end: end,
						_id: res._id
					  }, true);
				})

              //calendar.fullCalendar('unselect');

              $('.close1').click();
            });
          },
		  eventClick: function( calEvent, jsEvent, view ) {
			  console.log(calEvent)
			  if (calendar.fullCalendar( 'getView' ).name === 'month')
				  return false
            $('#fc_edit').click();

			$("#delete").off().on("click", function() {
				$.ajax({
					url: '/mentor/availability',
					type: 'DELETE',
					data: {
						_id: calEvent._id,
					}
				}).done(function (res) {
					window.location.reload()
				})
			})

            $("#update").hide();

            // calendar.fullCalendar('unselect');
		  },
          eventDrop: function(calEvent, delta, revertFunc, jsEvent) {
			  if (calendar.fullCalendar( 'getView' ).name === 'month') {
				  revertFunc()
				  return false
			  }

				$('#fc_edit').click();
				var start = calEvent.start
				var end = calEvent.end


				$(".close2").off().on("click", function() {
					revertFunc();
				});

				$("#delete").off().on("click", function() {
					$.ajax({
						url: '/mentor/availability',
						type: 'DELETE',
						data: {
							_id: calEvent._id,
						}
					}).done(function (res) {
						window.location.reload()
					})
				})

				$("#update").off().on("click", function() {
					$.ajax({
						url: '/mentor/availability',
						type: 'PUT',
						data: {
							_id: calEvent._id,
							start: start.valueOf(),
							end: end.valueOf(),
						}
					}).done(function (res) {
						calendar.fullCalendar('updateEvent', calEvent);
					})
					$('.close2').off().click();
			  	}).show();
          },
		  eventResize: function(calEvent, delta, revertFunc, jsEvent) {
			if (calendar.fullCalendar( 'getView' ).name === 'month') {
				revertFunc()
				return false
			}

			  $('#fc_edit').click();
			  var start = calEvent.start
			  var end = calEvent.end


			  $(".close2").off().on("click", function() {
				  revertFunc();
			  });

			  $("#delete").off().on("click", function() {
				  $.ajax({
					  url: '/mentor/availability',
					  type: 'DELETE',
					  data: {
						  _id: calEvent._id,
					  }
				  }).done(function (res) {
					  window.location.reload()
				  })
			  })

			  $("#update").off().on("click", function() {
				  $.ajax({
					  url: '/mentor/availability',
					  type: 'PUT',
					  data: {
						  _id: calEvent._id,
						  start: start.valueOf(),
						  end: end.valueOf(),
					  }
				  }).done(function (res) {
					  calendar.fullCalendar('updateEvent', calEvent);
				  })
				  $('.close2').off().click();
			  }).show();
		  },
          editable: true,
		  eventOverlap: false,
          events: calEvents,
        });
      });
    </script>
    <!-- /FullCalendar -->


    <!--
    <script>
      var opts = {
          lines: 12,
          angle: 0,
          lineWidth: 0.4,
          pointer: {
              length: 0.75,
              strokeWidth: 0.042,
              color: '#1D212A'
          },
          limitMax: 'false',
          colorStart: '#1ABC9C',
          colorStop: '#1ABC9C',
          strokeColor: '#F0F3F3',
          generateGradient: true
      };
      var target = document.getElementById('foo'),
          gauge = new Gauge(target).setOptions(opts);

      gauge.maxValue = 100;
      gauge.animationSpeed = 32;
      gauge.set(85);
      gauge.setTextField(document.getElementById("gauge-text"));
    </script>



    <script>
      var ctx = document.getElementById("canvasRadar");
      if (ctx) {
        var data = {
          labels: ["Eating", "Drinking", "Sleeping", "Designing", "Coding", "Cycling", "Running"],
          datasets: [{
            label: "My First dataset",
            backgroundColor: "rgba(3, 88, 106, 0.2)",
            borderColor: "rgba(3, 88, 106, 0.80)",
            pointBorderColor: "rgba(3, 88, 106, 0.80)",
            pointBackgroundColor: "rgba(3, 88, 106, 0.80)",
            pointHoverBackgroundColor: "#fff",
            pointHoverBorderColor: "rgba(220,220,220,1)",
            data: [65, 59, 90, 81, 56, 55, 40]
          }, {
            label: "My Second dataset",
            backgroundColor: "rgba(38, 185, 154, 0.2)",
            borderColor: "rgba(38, 185, 154, 0.85)",
            pointColor: "rgba(38, 185, 154, 0.85)",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(151,187,205,1)",
            data: [28, 48, 40, 19, 96, 27, 100]
          }]
        };

        var canvasRadar = new Chart(ctx, {
          type: 'radar',
          data: data,
        });
      }
    </script>
 	-->

    <!-- jQuery Sparklines -->
    <script>
      $(document).ready(function() {
        $(".sparkline_one").sparkline([2, 4, 3, 4, 5, 4, 5, 4, 3, 4, 5, 6, 7, 5, 4, 3, 5, 6], {
          type: 'bar',
          height: '40',
          barWidth: 9,
          colorMap: {
            '7': '#a1a1a1'
          },
          barSpacing: 2,
          barColor: '#26B99A'
        });

        $(".sparkline_two").sparkline([2, 4, 3, 4, 5, 4, 5, 4, 3, 4, 5, 6, 7, 5, 4, 3, 5, 6], {
          type: 'line',
          width: '200',
          height: '40',
          lineColor: '#26B99A',
          fillColor: 'rgba(223, 223, 223, 0.57)',
          lineWidth: 2,
          spotColor: '#26B99A',
          minSpotColor: '#26B99A'
        });
      });
    </script>
    <!-- /jQuery Sparklines -->

  </body>
</html>
